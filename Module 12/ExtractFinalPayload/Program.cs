using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.IO;

namespace ExtractFinalPayload
{
    class Program
    {
        static void Main(string[] args)
        {
            string datafile = @"C:\Users\Developer\Desktop\Module 12\ExtractFinalPayload\ExtractFinalPayload\PO3Oqrf.txt";
            string readText = "";

            if (File.Exists(datafile))
            {
                readText = File.ReadAllText(datafile);
            }

            byte[] byte_0 = Convert.FromBase64String(readText);
            string string_0 = "GoVYCdsJWrac";

            byte[] bytes = Encoding.ASCII.GetBytes(string_0);
            for (int i = 0; i <= byte_0.Length; i++)
            {
                byte_0[i % byte_0.Length] = Convert.ToByte((Convert.ToInt32((int)(byte_0[i % byte_0.Length] ^ bytes[i % bytes.Length])) - Convert.ToInt32(byte_0[(i + 1) % byte_0.Length]) + 256) % 256);
            }
            Array.Resize<byte>(ref byte_0, byte_0.Length - 1);

            string outfile = @"C:\Users\Developer\Desktop\Module 12\FinalPayload.bin";

            File.WriteAllBytes(outfile, byte_0);

            Console.ReadLine();

        }
    }
}
